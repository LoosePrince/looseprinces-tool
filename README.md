# LoosePrince's Tool

## 项目简介

**LoosePrince's Tool** 是一个基于 [Fabric](https://fabricmc.net/) 的 Minecraft 模组，添加一些物品或功能。

## 主要特性

- **模块化设计**：所有功能均为独立模块，互不干扰，易于扩展。
- **完善的配置系统**：所有功能均可通过 TOML 配置文件灵活调整（含注释）。
- **日志与热重载**：支持日志输出与功能热重载，方便调试与维护。

## 功能列表

- **飞行符文**：
  - 持有该物品即可在生存模式下飞行。

- **绑定附魔**：
  - 拥有该附魔的物品在死亡时不会掉落。

- **灵魂绑定**：
  - 附魔给物品后会记录玩家的 UUID，物品描述中显示"已绑定至:玩家名(uuid)"。
  - 附魔灵魂绑定后该物品丢出后无法被其它玩家拾取。
  - 在容器中（如箱子、漏斗等）无法被其它玩家拿起或移动（包括快捷键移动）。
  - 创造模式玩家不受上述拾取/移动限制影响。
  - 提供 II 级：
    - 掉落后 N 秒（默认 30s）自动回到绑定者（优先放入背包，否则传送至脚下）。
    - 岩浆中不会被烧毁，并会缓慢上浮。
    - 虚空中不会被销毁，会被抬升至世界底部线上方并上浮脱离。

- **丢弃诅咒**：
  - 附魔给物品后会记录玩家的 UUID，物品描述中显示"已绑定至:玩家名(uuid)"。
  - 附魔丢弃诅咒后该物品丢出会回到绑定者的背包。
  - 如果回到背包时背包以满会替换掉主手物品并使主手物品掉落。
  - 无法被移动（包括快捷键移动）到容器中（如箱子、漏斗等）。
  - 岩浆中不会被烧毁，并会缓慢上浮。
  - 虚空中不会被销毁，会被抬升至世界底部线上方并上浮脱离。
  - 非绑定者可以拾取该物品。

- **公平对决**：
  - 放在背包中时，每 0.5 秒自动赋予 1 秒的同名药水效果。
  - 持有效果时：根据玩家此前对同一生物造成的伤害占该生物生命上限的百分比，调整玩家从该生物处受到的伤害为"玩家生命上限 × 相同百分比 × 伤害转换比例"。该调整无视护甲、减伤（如抗性提升）与额外增伤。
  - 例：玩家对 100 血的铁傀儡造成 1 点伤害（1%），默认转换比例100%，则铁傀儡对玩家造成的伤害被调整为"玩家生命上限的 1%"。

- **神格系统**：
  - **残缺的神格**：史诗级物品，背包中持续获得"残缺的神格"效果，等同于抗性提升V + 公平对决效果。
  - **完整的神格**：神话级物品，背包中持续获得"神的力量"效果，提供完全无敌状态、禁用公平对决效果，并自动获得飞行能力。
  - **造物主的神格**：神话级物品，背包中持续获得"造物主"效果（包含"神的力量"，赋予无敌与生存飞行），并移除"残缺的神格"与"神的力量"效果。按Z（可配置）打开输入界面，输入物品 ID 以获取/扣除物品（成功后进入冷却）。冷却期间玩家将失去并无法获得"造物主"、"神的力量"、"残缺的神格"、"公平对决"效果且无法在生存模式下飞行，并获得用于显示剩余时间的"神力静默"效果，冷却结束时自动清除。
  - 两种神格物品均无法附魔，具有独特的故事背景和视觉效果。

- **神秘典籍**：
  - 神秘典籍是一种特殊的物品，可以打开一个界面，界面中包含词条目录和词条内容。
  - 神秘典籍在出生后由系统自动发放至背包（若背包已满则掉落于脚下）；右键使用打开典籍界面。
  - 词条目录中包含物品、药水、效果、文献和谣传。
  - 词条内容中包含词条的详细信息。
  - 词条采用解锁制。完成相关条件或使用特定物品后会逐步解锁，首次阅读会在目录右上角的小白点消失。
  - 禁用状态：当神秘典籍被“非绑定者”持有时，打开界面会被屏蔽，左侧仅显示“神秘典籍 - 禁用”，右侧显示屏蔽文案。

- **未知来源的手稿**：
  - 右键使用消耗 1 个，解锁“未知来源的手稿”文献词条，并从全部的“谣传”中随机解锁 1 条。
  - 第一次开启古城战利品箱：该箱子内必定生成 1 个“未知来源的手稿”。
  - 后续开启古城战利品箱：在战利品表中以 1.5% 概率生成“未知来源的手稿”。
  - 谣传用于揭示没有明确来源的碎片化故事。

## 系统要求

- **Minecraft 版本**：1.21
- **Java 版本**：Java 21 或更高
- **Fabric Loader**：0.16.14 或更高
- **Fabric API**：0.102.0+1.21 或兼容版本

## 安装方法

1. 安装 [Fabric Loader](https://fabricmc.net/use/) 和 [Fabric API](https://www.curseforge.com/minecraft/mc-mods/fabric-api)。
2. 下载本模组的 jar 文件，放入 `mods` 文件夹。
3. 启动游戏，模组会自动加载。
4. 首次运行后，可在 `config/looseprinces-tool.toml` 中调整配置。

## 配置说明

- 配置文件路径：`config/looseprinces-tool.toml`
- 直接编辑 TOML 文件即可启用/禁用各功能及其详细选项（文件内已包含注释说明）。

### 完整配置示例（TOML，含注释）

```toml
# LoosePrince's Tool 配置文件（TOML）
# 修改后保存即可，部分功能支持热重载，或重启游戏生效

# 模组配置版本，用于兼容性校验
version = "1.0.6"

# 各功能模块配置

# ------------------------ 飞行符文 ------------------------
[features.flying_rune]
# 启用本功能
enabled = true
[features.flying_rune.options]
# 是否允许在下界使用（默认 true）
allowInNether = true
# 是否允许在末地使用（默认 true）
allowInEnd = true
# 是否防止摔落伤害（默认 true）
preventFallDamage = true
# true=背包中即可飞行；false=需手持（默认 true）
requireInInventory = true

# ---------------------- 绑定附魔 ----------------------
[features.binding_enchantment]
enabled = true
[features.binding_enchantment.options]
# 是否防止掉落（默认 true）
preventDrop = true
# 是否影响所有物品（默认 true）
affectAllItems = true
# 附魔最大等级（默认 1）
maxLevel = 1

# ---------------------- 灵魂绑定 ----------------------
[features.soul_binding]
enabled = true
[features.soul_binding.options]
# 是否阻止其他玩家拾取（默认 true）
preventPickup = true
# 是否阻止其他玩家从容器中取出（默认 true）
preventContainerTake = true
# 是否显示拥有者信息（默认 true）
showOwnerTooltip = true
# II级: 掉落后自动回到拥有者秒数（默认 30）
level2TeleportSeconds = 30
# II级: 岩浆免疫（默认 true）
lavaImmune = true
# II级: 是否允许被虚空销毁（默认 false）
voidDestroyable = false

# ---------------------- 公平对决 ----------------------
[features.fair_duel]
enabled = true
[features.fair_duel.options]
# 伤害转换比例：1.0=100% 0.5=50% 2.0=200%（默认 1.0）
damageRatio = 1.0

# ---------------------- 神格系统 ----------------------
[features.divinity]
enabled = true
[features.divinity.options]
# 造物主冷却秒数（默认 900）
creatorCooldownSeconds = 900
# 获取/扣除的数量（范围 -64..640，默认 1；负数为扣除）
creatorGiveAmount = 1
```

### 命令

- `/lpt divinity clear_silence`：移除自身的"神力静默"效果并结束冷却

## 进度系统

本模组包含完整的进度系统，记录玩家的冒险历程：

### 进度列表

- **LoosePrince的工具箱** - 根进度，模组的入口
- **亵渎者的羽翼** - 获得飞行符文或在生存模式下飞行
- **神之尺度** - 激活公平对决效果
- **窃火者的荆棘冠** - 获得残缺的神格效果
- **王座承认了你** - 获得完整的神格效果
- **高天之上** - 获得“造物主”效果

### 进度获取

- **亵渎者的羽翼**：获得飞行符文或在生存模式下获得飞行能力
- **神之尺度**：获得“公平对决”效果
- **窃火者的荆棘冠**：获得“残缺的神格”效果
- **王座承认了你**：获得“神的力量”效果
- **高天之上**：获得“造物主”效果

## 开发与贡献

欢迎提交 Issue 或 PR 参与开发！

### 开发指南

- **代码结构**：采用模块化设计，所有功能均为独立模块，互不干扰
- **新功能开发**：实现 `Feature` 接口并注册到 `FeatureRegistry`
- **配置系统**：每个功能都有独立的配置类，支持 JSON 序列化
- **事件系统**：使用 Fabric 事件系统进行功能交互
- **本地化**：支持中文和英文，所有文本均在 `lang` 文件中定义

### 调试提示

- 使用`./gradlew build` 编译
- 使用 `./gradlew clean` 清理缓存，使用 `./gradlew --stop` 停止和清理
- 使用 `./gradlew runClient` 启动开发客户端
- 使用 `./gradlew runDatagen` 生成数据文件
- 配置文件位于 `run/config/looseprinces-tool.toml`
- 日志文件位于 `run/logs/` 目录
- 使用 `--offline` 以离线编译，速度更快，第一次运行不要使用此参数

## 致谢与协议

- 本项目由 LoosePrince 开发，遵循 MIT 协议。
- 感谢 Fabric 社区及所有开源贡献者。

---

如有建议或问题，欢迎在 Issue 区留言反馈！
